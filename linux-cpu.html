<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Linux CPU &#8211; dodwell.us</title>
<meta name="description" content="DevOPS: For fun and profit">
<meta name="keywords" content="">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dodwell.us/images/devops_logo.gif">
<meta name="twitter:title" content="Linux CPU">
<meta name="twitter:description" content="DevOPS: For fun and profit">
<meta name="twitter:creator" content="@MichaelDodwell">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux CPU">
<meta property="og:description" content="DevOPS: For fun and profit">
<meta property="og:url" content="https://dodwell.us/linux-cpu">
<meta property="og:site_name" content="dodwell.us">
<meta property="og:image" content="https://dodwell.us/images/default_bg1.jpg">





<link rel="canonical" href="https://dodwell.us/linux-cpu">
<link href="https://dodwell.us/feed.xml" type="application/atom+xml" rel="alternate" title="dodwell.us Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="stylesheet" type="text/css" href="https://dodwell.us/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="https://dodwell.us/assets/css/style.css" />






<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://dodwell.us/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://dodwell.us/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://dodwell.us/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://dodwell.us/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://dodwell.us/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://dodwell.us/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  
<div id="fade"></div>
<a id="slide" class="animated fade"></a>
<aside id="sidebar">
    <nav id="navigation">
    <h2>MENU</h2>
    <hr>

            <li>
                    <a href="https://dodwell.us/">Home</a>
                 </li>

            <li>
                    <a href="https://dodwell.us/resume"><i class="icon-book"></i> Resume</a>
                 </li>

            <li>
                    <a href="https://dodwell.us/categories">Categories</a>
                 </li>

            <li>
                    <a href="https://dodwell.us/tags">Tags</a>
                 </li>
            
           <li><a href="https://dodwell.us/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </nav>
    
    
</aside>

<header id="masthead" class="blog-background overlay align-center align-middle animated from-bottom"  style="background-image: url(https://dodwell.us/images/default_bg1.jpg)" itemscope itemtype="http://schema.org/Organization">



    <div class="inner">
        <div class="container">
            <a class="brand" href="https://dodwell.us" role="banner" itemprop="url">

                <img itemprop="logo" src="https://dodwell.us/images/devops_logo.gif" alt="dodwell.us Logo" />

            <h1 class="blog-title light" itemprop="name">
                dodwell.us
            </h1>
                
            </a>
        </div>
    </div>
    
    
    <div class="decor-wrapper">
        <svg id="header-decor" class="decor bottom" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
            <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

            <path class="medium left" d="M0 100 L50 50 L0 33.3" fill="rgba(255,255,255, .3)"></path>
            <path class="medium right" d="M100 100 L50 50 L100 33.3" fill="rgba(255,255,255, .3)"></path>

            <path class="small left" d="M0 100 L50 50 L0 66.6" fill="rgba(255,255,255, .5)"></path>
            <path class="small right" d="M100 100 L50 50 L100 66.6" fill="rgba(255,255,255, .5)"></path>

            <path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path>

            <path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path>

        </svg>
    </div>
    
</header>
<div id="main" class="content" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
    <div class="container">
        <div class="row">
            <article class="post col-md-8 col-md-offset-2 hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
            
            
            
                    <header class="post-header entry-header">
                    
                        
                        <h1 class="post-title text-center hyper lighter bordered-bottom entry-title" itemprop="headline">Linux CPU</h1>
                        
                        <div class="cursive" style="color: #000; font-style:italic;"></div>
                        <div class="post-info text-center small">
                            <span class="entry-date date published updated"><time datetime="2014-07-08T04:36:46+10:00" class="post-time" itemprop="datePublished">08 Jul 2014</time><span>
                            in <span class="post-tags"></span>&nbsp;<span class="post-tags"><i class="icon-time"></i>&nbsp;<span class="time">6.3</span> minutes read</span>
                        </div>
                    </header>
                    <div class="post-body bordered-bottom" itemprop="description">
                        
                        <p>Previously I wrote about <a href="https://dodwell.us/linux-memory/" title="Linux Memory">how memory works in Linux</a>. In this post I want to write about how the CPU is handled to service processes.</p>

<h3 id="processes">processes</h3>

<p>Before we get started pulling out stats it’s important to understand how processes in Linux work. All processes in Linux except process 0 (the swapper) is created when another process executes the fork() system call. The process that calls fork() is what is called the parent process and all the subsequent processes that it calls are called child processes. Every process (except process 0) has one parent process, but can have many child processes.</p>

<p>The operating system kernel identifies each process by its process identifier. Process 0 is a special process that is created when the system boots; after forking a child process (process 1), process 0 becomes the swapper process (sometimes also known as the “idle task”). Process 1, known as init, is the ancestor of every other process in the system.</p>

<h3 id="threads">threads</h3>

<p>Threads like processes are a mechanism to allow a program to do more than one thing at a time. As with processes, threads appear to run concurrently; the Linux kernel schedules them asynchronously, interrupting each thread from time to time to give others a chance to execute.</p>

<p>A thread exists within a process. Threads are a finer-grained unit of execution than processes. When you invoke a program, Linux creates a new process and in that process creates a single thread, which runs the program sequentially. That thread can create additional threads; all these threads run the same program in the same process, but each thread may be executing a different part of the program at any given time.</p>

<p>Unlike a child process where the process is separated from the parent and has it’s own resources (file descriptors, memory etc) a thread shares it’s processes resources. If a process has multiple threads and one of the threads closes a file descriptor for example the change affects all the other threads of the process.</p>

<h3 id="scheduling">scheduling</h3>

<p>As a note in versions of Linux kernel 2.6 prior to 2.6.23, the scheduler used is an O(1) scheduler by Ingo Molnár. The scheduler used thereafter is the Completely Fair Scheduler, also by Ingo Molnár, which runs in O(log N) time.</p>

<p>Because you can have multiple processes all running at the same time but we usually have a smaller number of core processors on the host, it’s important to realise that the kernel will switch (known as context switching) what process is running on the CPU at any time to another process that is in the queue waiting for CPU cycles. We end up with 2 different types of content switches, involuntary context switches and voluntary context switches. A voluntary context switch can occur whenever a thread/process makes a system call that blocks. An involuntary context switch occurs when a thread has been running too long (usually something like 10 ms) without making a system call that blocks and there are processes waiting for the CPU.</p>

<p>I don’t want to go into detail on how the scheduler works we just need to understand that context switching can be an important metric that we’ll talk about later.</p>

<h3 id="getting-information">getting information</h3>

<p>Now that we have a basic understanding on processors in Linux lets take a look at how we can find information about a running system.</p>

<p>If the server your investigating has multiple cores it’s useful to see the breakdown of each CPU. You can use a command called ‘mpstat’ to do this.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">root@earth:~# mpstat -P ALL
Linux 3.11.0-15-generic <span class="o">(</span>ultima<span class="o">)</span>        07/01/2014      _x86_64_        <span class="o">(</span><span class="m">4</span> CPU<span class="o">)</span>
09:14:01 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
09:14:01 PM  all    2.03    0.00    2.41    0.24    0.00    0.18    0.00    0.00    0.00   95.14
09:14:01 PM    <span class="m">0</span>    2.76    0.00    2.20    0.38    0.00    0.28    0.00    0.00    0.00   94.38
09:14:01 PM    <span class="m">1</span>    2.93    0.01    2.55    0.50    0.00    0.43    0.00    0.00    0.00   93.58
09:14:01 PM    <span class="m">2</span>    1.24    0.01    2.52    0.04    0.00    0.00    0.00    0.00    0.00   96.20
09:14:01 PM    <span class="m">3</span>    1.21    0.00    2.36    0.04    0.00    0.00    0.00    0.00    0.00   96.38
root@earth:~#</code></pre></figure>

<p>The mpstat command display activities for each available processor, processor 0 being the first one. Global average activities among all processors are also reported.</p>

<p>Sometimes you may wish to see how the CPU has been running over the day and a tool called ‘sar’ takes care of this. sar by default will grab archived information that has been written to via a cron job.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">root@earth:~# sar
Linux 3.11.0-15-generic <span class="o">(</span>earth<span class="o">)</span>        07/01/2014      _x86_64_        <span class="o">(</span><span class="m">8</span> CPU<span class="o">)</span>
07:35:01 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
07:45:01 PM     all      0.31      0.00      0.38      0.06      0.00     99.25
07:55:01 PM     all      0.39      0.00      0.50      0.07      0.00     99.05
08:05:01 PM     all      0.31      0.00      0.37      0.05      0.00     99.27
08:15:01 PM     all      0.31      0.00      0.39      0.05      0.00     99.25
08:25:01 PM     all      0.38      0.00      0.50      0.05      0.00     99.06
08:35:01 PM     all      0.30      0.00      0.39      0.05      0.00     99.26
08:42:37 PM     all      0.55      0.00      0.57      0.19      0.00     98.69
08:45:01 PM     all      4.52      0.00      2.87      9.36      0.00     83.25
08:55:01 PM     all      4.64      0.00      1.47     10.02      0.00     83.87
09:05:01 PM     all      2.20      0.00      1.01      3.95      0.00     92.84
09:15:01 PM     all      3.31      0.00      1.15      3.71      0.00     91.83
Average:        all      1.36      0.00      0.73      2.04      0.00     95.87
root@earth:~#</code></pre></figure>

<p>The sar command can also be ran so that you can see a live summary over time.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">root@earth:~# sar -u <span class="m">2</span> 5
Linux 3.11.0-15-generic <span class="o">(</span>earth<span class="o">)</span>        07/01/2014      _x86_64_        <span class="o">(</span><span class="m">8</span> CPU<span class="o">)</span>
09:22:16 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
09:22:18 PM     all      3.13      0.00      1.63      1.56      0.00     93.68
09:22:20 PM     all      6.25      0.00      6.50      1.06      0.00     86.18
09:22:22 PM     all      1.32      0.00      1.69      5.52      0.00     91.47
09:22:24 PM     all      1.07      0.00      0.50      3.07      0.00     95.36
09:22:26 PM     all      0.88      0.00      0.31      1.50      0.00     97.31
Average:        all      2.53      0.00      2.13      2.54      0.00     92.80
root@earth:~#</code></pre></figure>

<p>I think it’s important to break down what we’re actually reading with these outputs. %user is the percentage of CPU utilization that occurred while executing at the user level (application). %nice is the percentage of CPU utilization that occurred while executing at the user level with nice priority. %system is the percentage of CPU utilization that occurred while executing at the system level (kernel). %iowait is the percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request. %steal is the percentage of time a virtual CPU waits for a real CPU while the hyper visor is servicing another virtual processor. %idle is the percentage of time that the CPU or CPUs were idle and the system did not have an outstanding disk I/O request.</p>

<h3 id="munin">munin</h3>

<p><a href="/images/cpu-day.png"><img src="/images/cpu-day.png" alt="cpu-day" width="378" height="286" style="float:left;" /></a>Using programs like Munin also are helpful in determining how CPU usage is performing over time. In the graph to the side we can quickly tell that the CPU on this host is fairly idle. It saves us considerable time if we have to review lots of servers on a periodic basis for this kind of information to be graphed in a easily read fashion. It is also helpful to look at trending over long periods of time that might not be that evident when looking at hourly/daily trends.</p>

<blockquote>
  <p>UPDATE (17/07/14): I just wanted to add a update to state something that I don’t think is that clear about steal time. A guest’s allocated CPU type will match the physical CPU of the host. If a service provider wishes to offer a ‘slower CPU’ but only host virtual machines on faster processors they will restrict the CPU resource on the host for the guest and when you run the guest you will see this reflected in the CPU steal time.</p>
</blockquote>

                        <br>
                    
                    
                    </div>
        </div>
                    <footer class="post-footer entry-meta">
                        <div class="post-share text-center">
    <p class="light small">
        Share this post
    </p>
    <ul class="social-mini">
        <li>
            <a href="https://twitter.com/intent/tweet?text=&quot;Linux CPU&quot;%20https://dodwell.us/linux-cpu%20via%20&#64;MichaelDodwell"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" data-toggle="tooltip" title="Share on Twitter" itemprop="Twitter">
                <i class="icon-twitter"></i>
            </a>
        </li>
        <li>
            <a  href="https://www.facebook.com/sharer/sharer.php?u=https://dodwell.us/linux-cpu"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" data-toggle="tooltip" title="Share on Facebook" itemprop="Facebook">
                <i class="icon-facebook"></i>
            </a>
        </li>
        <li>
            <a href="https://plus.google.com/share?url=https://dodwell.us/linux-cpu"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" data-toggle="tooltip" title="Share on Google plus" itemprop="GooglePlus">
                <i class="icon-google-plus"></i>
            </a>
        </li>
    </ul>
</div>
                        <div class="post-author text-center">                       
	        <img src="https://dodwell.us/images/dodwmd.jpg" alt="Michael Dodwell's photo" itemprop="image" class="post-avatar img-circle img-responsive"/>    
	    <h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person">By <span itemprop="name" class="fn"><a href="https://dodwell.us/resume/" title="About Michael Dodwell" itemprop="url">Michael Dodwell</a></span></h4>
	    <p>I have a strong analytical and problem solving background in multi-platform systems administration and computing solutions and I am able to identify problems and facilitate solutions in a timely matter. Therefore, I am most interested in a challenging and responsible position where my initiative, experience, and interpersonal skills will be fully utilized and valued.</p>
</div>
 
                        
                    </footer>
            </article>
    </div>
</div>

<footer id="footer"  class="blog-background overlay text-center align-middle animated from-top" style="background-image: url(https://dodwell.us/images/default_bg1.jpg)" >


    <div class="inner">
        <div class="container">

            <ul class="social-icons">
            <li>
                <a href="http://twitter.com/MichaelDodwell" data-toggle="tooltip" title="Michael Dodwell on Twitter" target="_blank">
                    <i class="icon-twitter"></i>
                </a>
            </li>
            
            
            
            <li>
                <a href="https://au.linkedin.com/in/michaeldodwell" data-toggle="tooltip" title="Michael Dodwell on LinkedIn" target="_blank">
                    <i class="icon-linkedin"></i>
                </a>
            </li>
            
            
            <li>
                <a href="http://github.com/dodwmd" data-toggle="tooltip" title="Michael Dodwell on Github" target="_blank">
                    <i class="icon-github"></i>
                </a>
            </li>
        </ul>
            <div>
                <a href="https://dodwell.us/resume/">Michael Dodwell</a> &copy; 2016 &bull; All rights reserved.
            </div>
            <ul class="menu-items">
            
            <li>
                
                    <a href="https://dodwell.us/"><i class="icon-home"></i></a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="https://dodwell.us/resume"><i class="icon-book"></i> Resume</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="https://dodwell.us/categories">Categories</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="https://dodwell.us/tags">Tags</a>&nbsp;&bull;
                 
            </li>
            
            <li><a href="https://dodwell.us/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
        </ul>
        </div>
    </div>
    
        <div class="decor-wrapper">
            <svg id="footer-decor" class="decor top" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">

                <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
                <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

                <path class="medium left" d="M0 0 L50 50 L0 66.6" fill="rgba(255,255,255, .3)"></path>
                <path class="medium right" d="M100 0 L50 50 L100 66.6" fill="rgba(255,255,255, .3)"></path>

                <path class="small left" d="M0 0 L50 50 L0 33.3" fill="rgba(255,255,255, .5)"></path>
                <path class="small right" d="M100 0 L50 50 L100 33.3" fill="rgba(255,255,255, .5)"></path>

                <path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path>

                <path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path>

            </svg>
        </div>
    
</footer>


    
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://dodwell.us/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://dodwell.us/assets/js/scripts.min.js"></script>
<script type="text/javascript" src="https://dodwell.us/assets/js/waypoints.min.js"></script>
<script type="text/javascript" src="https://dodwell.us/assets/js/script.js"></script>
<script type='text/javascript'>$(document).ready(function(){$(".time").text(function(a,b){return Math.round(parseFloat(b))})});</script>

<script type="text/javascript">

/*      Slides       */

$("a#slide").click(function(){
    $("#sidebar,body,a#slide,#fade").addClass("slide")
});

$("#fade,#header,#posts-container").click(function(){
    $("#sidebar,body,a#slide,#fade").removeClass("slide")
});

$("a#click-filter").click(function(){
    $("#slide-filter").slideToggle("medium");
    $("#slide-pages").slideOut("medium");
});

$("a#click-pages").click(function(){
    $("#slide-pages").slideToggle("medium");
    $("#slide-filter").slideOut("medium");
});

/*      End-Slides      */

</script>



<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-60832716-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


 
</body>
</html>
